{% extends 'chem21/base_learning.html' %}
{% load tokens %}
{% load admin_urls %}
{% block head %}
{% endblock %}
{% block title %}{{ object.title }} :: {{ current_lesson.title }} :: {{ current_module.title }} :: CHEM21 learning platform{% endblock %}
{% block display_title %}{% if current_module.dummy %}{{ current_module.topic.title }} {% else %} {{ current_module.title }} {% endif %}: {{ current_lesson.title }}{% endblock %}
{% block class_nav %}
<div class="item-list">
	<ol>
	{% for module in class_tree.modules.all|dictsort:"order" %}
		{% ifequal module current_module %}
			
				{% if module.dummy %}
					{% include 'chem21/include/active_module_nav.html' with module=module current_question=object %}
				{% else %}
				<li class="active">
				{% if module.text|striptags or perms.repo.change_module %}
			
				<a href="{{ module.get_absolute_url }}">{{ module.name }}</a>
			
			{% else %}
			{{ module.name }}
			{% endif %}
				
				<div class="item-list"><ol class="active">
					{% include 'chem21/include/active_module_nav.html' with module=module current_question=object %}
					
				</ol></div>
				</li>
				{% endif %}

		{% else %}
			{% if module.dummy %}
				{% include 'chem21/include/active_module_nav.html' with module=module current_question=object %}
			{% else %}
			<li>
				<a href="{{ module.get_absolute_url }}">{{ module.name }}</a>
			</li>
			{% endif %}
		{% endifequal %}
	{% endfor %}
	</ol>
</div>  
{% endblock %}
{% block progress_title %}
<div class="titles"><h2>{{ object.title }}</h2>(Step {{ question_num }} of {{ num_questions }})</div>
{% endblock progress_title %}
{% block learning_object %}


{% block question %}
{% if perms.repo.change_question %}
<a class="admin-edit" href="{% url opts.question|admin_urlname:'change' object.pk %}"
		data-from-url-edit="{% url opts.question|admin_urlname:'changelist' %}">
		Edit</a>
	{% if object.video %}
	<a class="admin-edit" href="{% url opts.uniquefile|admin_urlname:'change' object.video.pk %}"
			data-from-url-edit="{% url opts.uniquefile|admin_urlname:'changelist' %}">Edit video attributes</a>
	{% endif %}
{% endif %}
{% if object.text %}
{% replace_tokens object.text %}
{{ tokens_replaced|safe }}
{% endif %}
{% if object.video %}
<figure class="presentation">
<video width="100%" controls>
	<source src="{{ object.video.url }}" type="video/mp4" />
	Your browser does not support the video tag
</video>
<figcaption class="overlay">
{% if object.byline|striptags %}
	{{ object.byline|safe }}
{% else %}
	Presentation by <span class="byline">{{ object.video.author_string }}</span></figcaption>
{% endif %}
</figcaption>
</figure>
{% endif %}
{% if object.pdf %}
<a href="{{ object.pdf.url }}" class="embed">{{ object.pdf.filename }}</a>
<!-- TODO: display pdf -->
{% endif %}
{% block bottom_nav %}
<nav id="end-nav">
	
	{% if next %}<div class="next"><span class="next">Next</span> &raquo; <a class="next" href="{{ next.get_absolute_url }}">{{ next.title }} </a></div>{% endif %}
	{% if previous %}<div class="back"><span class="next">Back</span> &laquo; <a class="prev" href="{{ previous.get_absolute_url}}" title="{{ previous.get_absolute_url }}">{{ previous.title }}</a></div>{% endif %}
	</nav>
	{% endblock %}
{% if footnotes_html %}
<ol class="footnotes">
{{ footnotes_html|safe }}
</ol>
{% endif %}
{% endblock %}
{% endblock %}