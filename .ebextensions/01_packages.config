packages:
 yum:
  git: []
  libjpeg-turbo-devel: []
  xz: []
  urw-fonts: []
  libXext: []
  openssl-devel: []
  libXrender: []
  python27-devel: []
  postgresql93-devel: []
  libxml2-devel: []
  libxslt-devel: []
  postgresql93-libs: []

container_commands:
 01_install_node:
  command: 'yum install -y nodejs --enablerepo=epel'

 02_migrate:
   command: "source /opt/python/run/venv/bin/activate && python manage.py migrate --noinput"
   leader_only: true

 03_load_db_content_may2017:
  command: "source /opt/python/run/venv/bin/activate && python manage.py initialise_data fixtures/init_data.json"
 
 04_load_superusers:
  command: "source /opt/python/run/venv/bin/activate && python manage.py create_su"

 05_collect_static:
  command: "source /opt/python/run/venv/bin/activate && python manage.py collectstatic"

 06_install_requirejs:
  command: "npm install -g requirejs"

 07_build_static:
  command: "r.js -o require-build.js"

 08_install_cli:
  command: "curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\" && unzip awscliv2.zip && ./aws/install"

 08_push_to_s3:
  command: "aws s3 sync collected-static/deploy/ s3://${AWS_STORAGE_BUCKET_NAME}/static"
